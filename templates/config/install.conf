#!/bin/bash
# =========================================================================
# Zer0-Mistakes Installation Configuration
# =========================================================================
# Central configuration file for all installation scripts and templates.
# This file defines variables used across install.sh, fork-cleanup.sh,
# and test scripts.
#
# Usage: source "templates/config/install.conf"
# =========================================================================

# -------------------------------------------------------------------------
# Theme Identity
# -------------------------------------------------------------------------
export THEME_NAME="zer0-mistakes"
export THEME_GEM_NAME="jekyll-theme-zer0"
export THEME_DISPLAY_NAME="Zer0-Mistakes Jekyll Theme"

# -------------------------------------------------------------------------
# GitHub Repository
# -------------------------------------------------------------------------
export GITHUB_USER="bamr87"
export GITHUB_REPO="${GITHUB_USER}/${THEME_NAME}"
export GITHUB_URL="https://github.com/${GITHUB_REPO}"
export GITHUB_RAW_URL="https://raw.githubusercontent.com/${GITHUB_REPO}/main"
export GITHUB_PAGES_URL="https://${GITHUB_USER}.github.io/${THEME_NAME}"

# -------------------------------------------------------------------------
# Development Server
# -------------------------------------------------------------------------
export DEFAULT_PORT=4000
export DEFAULT_HOST="localhost"
export DEFAULT_URL="http://${DEFAULT_HOST}:${DEFAULT_PORT}"

# -------------------------------------------------------------------------
# Ruby Gem Versions
# -------------------------------------------------------------------------
export JEKYLL_VERSION="~> 4.3"
export FFI_VERSION="~> 1.17.0"
export WEBRICK_VERSION="~> 1.7"
export COMMONMARKER_VERSION="0.23.10"

# -------------------------------------------------------------------------
# Installation Modes
# -------------------------------------------------------------------------
# full    - Complete theme with all assets, layouts, includes, and Docker
# minimal - Bare minimum for GitHub Pages remote theme usage
# fork    - Clone/fork with example content removed for clean starting point
export VALID_INSTALL_MODES="full minimal fork"
export DEFAULT_INSTALL_MODE="full"

# -------------------------------------------------------------------------
# Template Variables (for {{VAR}} substitution)
# -------------------------------------------------------------------------
# These are the variable names that can be used in .template files
# Format: {{VAR_NAME}} will be replaced with the value
export TEMPLATE_VARS=(
    "THEME_NAME"
    "THEME_GEM_NAME"
    "THEME_DISPLAY_NAME"
    "GITHUB_USER"
    "GITHUB_REPO"
    "GITHUB_URL"
    "GITHUB_RAW_URL"
    "GITHUB_PAGES_URL"
    "DEFAULT_PORT"
    "DEFAULT_HOST"
    "DEFAULT_URL"
    "JEKYLL_VERSION"
    "FFI_VERSION"
    "WEBRICK_VERSION"
    "COMMONMARKER_VERSION"
    "SITE_TITLE"
    "SITE_DESCRIPTION"
    "SITE_AUTHOR"
    "SITE_EMAIL"
    "CURRENT_DATE"
    "CURRENT_YEAR"
)

# -------------------------------------------------------------------------
# Fork Mode: Paths to Remove (example content)
# -------------------------------------------------------------------------
# These paths are removed when using --fork mode to create a clean template
export FORK_REMOVE_PATHS=(
    # Example blog posts
    "pages/_posts"
    # Jupyter notebook examples
    "pages/_notebooks"
    # Creator profile content
    "pages/_about/profile"
    "pages/_about/stats.md"
    # AI-generated preview images
    "assets/images/previews"
    # Site-specific assets
    "assets/images/gravatar.png"
    "assets/images/gravatar-small.png"
    # Generated statistics
    "_data/content_statistics.yml"
    # Custom domain
    "CNAME"
    # Built gem files
    "jekyll-theme-zer0-*.gem"
    # Build artifacts
    "_site"
    "logs"
    "reports"
    "vendor"
    # Backup files
    "*.backup.*"
)

# -------------------------------------------------------------------------
# Fork Mode: Files to Reset with Template Values
# -------------------------------------------------------------------------
export FORK_RESET_FILES=(
    "_config.yml"
    "_data/authors.yml"
)

# -------------------------------------------------------------------------
# Essential Theme Files (always required)
# -------------------------------------------------------------------------
export ESSENTIAL_DIRS=(
    "_layouts"
    "_includes"
    "_sass"
    "_plugins"
    "assets/css"
    "assets/js"
)

export ESSENTIAL_FILES=(
    "_config.yml"
    "Gemfile"
    "index.html"
    "404.html"
)

# -------------------------------------------------------------------------
# Embedded Fallback Flag
# -------------------------------------------------------------------------
# When templates directory is not available (e.g., curl | bash install),
# scripts should use embedded fallback content
export FALLBACK_EMBEDDED=false

# -------------------------------------------------------------------------
# Helper function: Check if templates are available
# -------------------------------------------------------------------------
templates_available() {
    local script_dir="${1:-$(dirname "${BASH_SOURCE[0]}")}"
    local templates_dir="$script_dir/../../templates"
    
    if [[ -d "$templates_dir" ]] && [[ -f "$templates_dir/config/install.conf" ]]; then
        return 0
    fi
    return 1
}

# -------------------------------------------------------------------------
# Helper function: Get templates directory path
# -------------------------------------------------------------------------
get_templates_dir() {
    local script_dir="${1:-$(dirname "${BASH_SOURCE[0]}")}"
    echo "$script_dir/../../templates"
}
