<!--
  ===================================================================
  HEADER - Main Navigation and Site Header
  ===================================================================
  
  File: header.html
  Path: _includes/header.html
  Purpose: Primary site navigation with responsive design and 
           offcanvas mobile menu integration
  
  Template Logic:
  - Responsive navigation bar with Bootstrap 5 components
  - Offcanvas sidebars for mobile navigation
  - Brand logo and home navigation integration
  - Settings modal and navigation toggles
  - Skip-to-content link for accessibility
  
  Dependencies:
  - branding.html: Site title and logo display
  - navbar.html: Main navigation menu items
  - Bootstrap 5 offcanvas and navbar components
  
  Responsive Behavior:
  - Desktop: Full horizontal navigation bar
  - Mobile: Collapsed navigation with hamburger menu
  - Offcanvas panels for sidebar and navigation
  
  Accessibility:
  - Skip-to-content link for keyboard navigation
  - ARIA labels for screen readers
  - Focus management for offcanvas
  
  TODO: Fix Nanobar progress bar positioning and animation
  ===================================================================
-->

<!-- ================================ -->
<!-- SKIP TO CONTENT LINK            -->
<!-- ================================ -->
<!-- Accessibility: allows keyboard users to skip navigation -->
<a href="#main-content" class="visually-hidden-focusable position-absolute top-0 start-0 z-3 m-3 btn btn-primary">
  Skip to main content
</a>

<header id="navbar" class="container-fluid text-center fixed-top" role="navigation">

    <!-- ================================ -->
    <!-- TOP NAVIGATION BAR              -->
    <!-- ================================ -->
    <div class="navbar navbar-expand-lg bg-body-tertiary flex-nowrap justify-content-center bottom-shadow">
       
        <!-- ========================== -->
        <!-- PROGRESS BAR INDICATOR    -->
        <!-- ========================== -->
        <!-- Fixed position progress bar for page loading feedback -->
        <div class="nanobar" id="top-progress-bar" style="position: fixed;">
            <div class="bar"></div>
        </div>
        
        <!-- ========================== -->
        <!-- MAIN NAVIGATION CONTAINER -->
        <!-- ========================== -->
        <nav class="container-xl order-2 order-lg-1 grid gap-1 navbar-main">

            <!-- ========================== -->
            <!-- MOBILE MENU CONTROLS      -->
            <!-- ========================== -->
            
            <!-- Left Sidebar Toggle - Mobile view only -->
            {% assign sidebar_nav = page.sidebar.nav | default: nil %}
            {% assign sidebar_has_content = false %}
            {% if sidebar_nav %}
                {% if sidebar_nav == "auto" or sidebar_nav == "categories" %}
                    {% assign sidebar_has_content = true %}
                {% elsif site.data.navigation[sidebar_nav] %}
                    {% assign sidebar_has_content = true %}
                {% endif %}
            {% endif %}

            {% if sidebar_has_content %}
            <div class="bd-navbar-toggle">
                <button class="navbar-toggler p-2" 
                        type="button" 
                        data-bs-toggle="offcanvas" 
                        data-bs-target="#bdSidebar" 
                        aria-controls="bdSidebar" 
                        aria-label="Toggle sidebar navigation">
                    <span class="bi bi-list"></span>
                </button>
            </div>
            {% endif %}

            <!-- ========================== -->
            <!-- BRAND AND HOME NAVIGATION -->
            <!-- ========================== -->
            <div class="navbar-brand-group d-inline-flex align-items-center gap-2">
                <!-- Home Navigation Button (Desktop only) -->
                <div class="navbar-home-links d-none d-lg-inline-flex">
                    {%- for home in site.data.navigation.home -%}
                    <a class="btn" href="{{ home.url | relative_url }}" aria-label="{{ home.title }}" title="{{ home.title }}">
                        <i class="{{ site.default_icon}} {{ home.icon }}"></i>
                    </a>
                    {% endfor %}
                </div>
                
                <!-- Brand Logo Link to Root -->
                <!-- Logo path configured in _config.yml -->
                {% capture logo_path %}{{ site.logo }}{% endcapture %}
                <a class="navbar-brand" href="{{ site.baseurl }}/" aria-label="Home">
                    <img src="{{ logo_path | relative_url }}" alt="Logo" width="30" height="30">
                </a>
            </div>
            
            <!-- ========================== -->
            <!-- SITE BRANDING SECTION     -->
            <!-- ========================== -->
            <!-- Site title and subtitle display -->
            {% include core/branding.html %}
    
            <!-- ========================== -->
            <!-- MAIN NAVIGATION MENU      -->
            <!-- ========================== -->
            <!-- Primary navigation items from _data/navigation.yml -->
            {% include navigation/navbar.html %}

            <!-- ========================== -->
            <!-- UTILITY CONTROLS          -->
            <!-- ========================== -->
            <div class="navbar-utility-controls d-flex align-items-center">
                <!-- Search Modal Toggle -->
                <button
                    class="btn nav-search-button"
                    type="button"
                    data-bs-toggle="modal"
                    data-bs-target="#siteSearchModal"
                    data-search-toggle
                    aria-label="Open search"
                    title="Search"
                >
                    <i class="{{site.default_icon}} bi-search"></i>
                    <span class="nav-link-text d-none d-xl-inline ms-1">Search</span>
                </button>

                <!-- Settings Modal Toggle -->
                <button
                    class="btn nav-settings-button d-none d-lg-inline-flex"
                    type="button"
                    data-bs-toggle="modal" 
                    data-bs-target="#info-section" 
                    aria-label="Settings"
                    title="Settings"
                >
                    <i class="{{site.default_icon}} bi-gear"></i>
                </button>

                <!-- Navigation Menu Toggle - Mobile view -->
                <div class="bd-navbar-toggle d-lg-none">
                    <button class="navbar-toggler p-2" 
                            type="button" 
                            data-bs-toggle="offcanvas" 
                            data-bs-target="#bdNavbar" 
                            aria-controls="bdNavbar" 
                            aria-label="Toggle navigation">
                        <span class="bi bi-three-dots"></span>
                    </button>
                </div>
            </div>
        </nav>
    </div>
</header>