{% comment %}
  PREVIEW IMAGE - Simple, Consistent Image Rendering
  
  Usage:
    {%- include components/preview-image.html 
       src=post.preview 
       alt=post.title 
       class="card-img-top" 
       style="height: 180px; object-fit: cover;" 
    -%}
  
  Convention: Preview paths can omit the /assets/ prefix.
  The component will auto-prepend the assets_prefix from _config.yml.
  Examples:
    - /images/previews/my-image.png → /assets/images/previews/my-image.png
    - /assets/images/previews/my-image.png → unchanged
    - https://example.com/image.png → unchanged (external URL)
{% endcomment %}
{% assign img = include.src | default: site.teaser %}
{% assign alt = include.alt | default: "Preview image" %}
{% assign class = include.class | default: "card-img-top" %}
{% assign style = include.style %}
{% assign loading = include.loading | default: "lazy" %}

{% comment %} Get assets prefix configuration {% endcomment %}
{% assign assets_prefix = site.preview_images.assets_prefix | default: '/assets' %}
{% assign auto_prefix = site.preview_images.auto_prefix | default: true %}

{% comment %} Determine final image source {% endcomment %}
{% if img contains '://' %}
  {% comment %} External URL - use as-is {% endcomment %}
  {% assign final_src = img %}
{% elsif auto_prefix and img != blank %}
  {% comment %} Check if path already has the assets prefix {% endcomment %}
  {% if img contains assets_prefix %}
    {% assign final_src = img | relative_url %}
  {% else %}
    {% comment %} Prepend assets prefix to the path {% endcomment %}
    {% assign final_src = assets_prefix | append: img | relative_url %}
  {% endif %}
{% else %}
  {% assign final_src = img | relative_url %}
{% endif %}

<img src="{{ final_src }}" 
     class="{{ class }}" 
     alt="{{ alt | escape }}"
     {% if style %}style="{{ style }}"{% endif %}
     loading="{{ loading }}">
