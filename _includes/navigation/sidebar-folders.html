<!--
  ===================================================================
  SIDEBAR FOLDERS - Collection Document Folder Structure
  ===================================================================
  
  File: sidebar-folders.html
  Path: _includes/navigation/sidebar-folders.html
  Purpose: Display collection documents organized by folder structure
  
  Template Logic:
  - Gets the current page's collection
  - Sorts documents by path to maintain folder hierarchy
  - Displays folder names and document links
  - Uses Bootstrap list-group for styling
  
  Dependencies:
  - page.collection: Current collection name from page front matter
  - site.collections: Jekyll collections configuration
  - Bootstrap 5 list-group component
  
  Usage:
  - Include in sidebar when page.sidebar.nav == "dynamic"
  - Requires page to be part of a Jekyll collection
  ===================================================================
-->

{% assign root_folder = site.collections | where: "label", page.collection | first %}

{% if root_folder %}
  <h2 class="h5 mb-3">
    <i class="bi bi-folder me-2"></i>
    {{ root_folder.label | capitalize }}
  </h2>
  
  {% assign docs = root_folder.docs | sort: 'path' %}
  {% assign prev_path = "" %}
  
  <ul class="list-group list-group-flush">
    {% for doc in docs %}
      {% assign current_path = doc.path | split: '/' | pop %}
      
      {% if current_path != prev_path %}
        {% for folder in current_path %}
          {% if forloop.index != 1 %}
            <li class="folder list-group-item bg-body-tertiary fw-semibold">
              <i class="bi bi-folder2 me-1"></i>
              {{ folder }}
            </li>
          {% endif %}
        {% endfor %}
        {% assign prev_path = current_path %}
      {% endif %}
      
      <li class="file list-group-item list-group-item-action{% if page.url == doc.url %} active{% endif %}">
        <a href="{{ doc.url | relative_url }}" class="text-decoration-none">
          <i class="bi bi-file-text me-1"></i>
          {{ doc.title }}
        </a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="text-muted small">
    <i class="bi bi-info-circle me-1"></i>
    No collection found for this page.
  </p>
{% endif %}