<!-- 
    file: navbar.html
    path: /includes/navbar.html
    includes:
    purpose: Offcanvas main navigation following Bootstrap 5 best practices
             with hover-activated dropdowns for desktop
 -->

<!-- Navigation Links - Offcanvas -->
<div class="offcanvas offcanvas-end col-lg-2" tabindex="-1" id="bdNavbar" aria-labelledby="mainNavOffcanvasLabel">

    <!-- Main Navigation Header - Offcanvas -->
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title" id="mainNavOffcanvasLabel">Main Navigation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#bdNavbar"></button>
    </div>

    <!-- Main Navigation Body - Offcanvas -->
    <div class="offcanvas-body">
        <ul class="navbar-nav justify-content-lg-center text-start flex-grow-1">
            <li class="nav-item d-lg-none">
                <a class="nav-link" href="{{ '/' | relative_url }}">
                    <i class="{{site.default_icon}} bi-house me-2"></i>
                    Home
                </a>
            </li>
            {%- for link in site.data.navigation.main -%}
                {%- assign has_children = link.children and link.children.size > 0 -%}

                {%- if has_children -%}
                    <li class="nav-item dropdown d-flex align-items-center nav-hover-dropdown">
                        <!-- Parent link navigates directly -->
                        <a
                            class="nav-link"
                            href="{{ link.url | relative_url }}"
                            {%- if link.url == page.url -%} aria-current="page"{%- endif -%}
                            title="{{ link.title }}"
                        >
                            {%- if link.icon -%}
                                <i class="{{site.default_icon}} {{ link.icon }}"></i>
                            {%- endif -%}
                            <span class="nav-link-text">{{ link.title }}</span>
                        </a>

                        <!-- Split toggle opens the dropdown (click on mobile, hover on desktop) -->
                        <a
                            class="nav-link dropdown-toggle dropdown-toggle-split ms-1 px-1"
                            href="#"
                            id="dropdown-{{ link.title | slugify }}"
                            role="button"
                            data-bs-toggle="dropdown"
                            data-bs-auto-close="outside"
                            aria-expanded="false"
                            aria-label="Toggle {{ link.title }} menu"
                        >
                            <span class="visually-hidden">Toggle dropdown</span>
                        </a>

                        <ul class="dropdown-menu dropdown-menu-start" aria-labelledby="dropdown-{{ link.title | slugify }}">
                            {%- for child in link.children -%}
                                <li>
                                    <a
                                        class="dropdown-item"
                                        href="{{ child.url | relative_url }}"
                                        {%- if child.url == page.url -%} aria-current="page"{%- endif -%}
                                    >
                                        {%- if child.icon -%}
                                            <i class="{{site.default_icon}} {{ child.icon }} me-2"></i>
                                        {%- endif -%}
                                        {{ child.title }}
                                    </a>
                                </li>
                            {%- endfor -%}
                        </ul>
                    </li>
                {%- else -%}
                    <li class="nav-item">
                        <a
                            class="nav-link"
                            href="{{ link.url | relative_url }}"
                            {%- if link.url == page.url -%} aria-current="page"{%- endif -%}
                            title="{{ link.title }}"
                        >
                            {%- if link.icon -%}
                                <i class="{{site.default_icon}} {{ link.icon }}"></i>
                            {%- endif -%}
                            <span class="nav-link-text">{{ link.title }}</span>
                        </a>
                    </li>
                {%- endif -%}
            {%- endfor -%}
            <li class="nav-item d-lg-none">
                <button
                    class="nav-link btn btn-link text-start w-100"
                    type="button"
                    data-bs-toggle="modal"
                    data-bs-target="#siteSearchModal"
                    data-search-toggle
                    aria-label="Open search"
                >
                    <i class="{{site.default_icon}} bi-search me-2"></i>
                    Search
                </button>
            </li>
            <li class="nav-item d-lg-none">
                <button
                    class="nav-link btn btn-link text-start w-100"
                    type="button"
                    data-bs-toggle="modal"
                    data-bs-target="#info-section"
                    aria-controls="info-section"
                >
                    <i class="{{site.default_icon}} bi-gear me-2"></i>
                    Settings
                </button>
            </li>
        </ul>
    </div>
</div>

<!-- 
  Navigation styles are now in _sass/core/_navbar.scss
  Navigation scripts are now in assets/js/navigation.js
  These are loaded automatically via the theme's asset pipeline
-->