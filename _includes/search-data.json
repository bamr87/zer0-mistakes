[
{%- assign search_pages = site.pages | where_exp: "item", "item.title" -%}
{%- assign search_posts = site.posts -%}
{%- assign search_docs = site.documents -%}
{%- assign search_items = search_pages | concat: search_posts | concat: search_docs -%}
{%- assign content_limit = site.search.content_length | default: 1000 -%}
{%- assign first = true -%}
{%- for item in search_items -%}
    {%- if item.url and item.title -%}
        {%- if item.url contains '/assets/' or item.url == '/search.json' -%}
            {%- continue -%}
        {%- endif -%}
        {%- unless first -%},{%- endunless -%}
        {
            "title": {{ item.title | strip_newlines | jsonify }},
            "url": {{ item.url | relative_url | jsonify }},
            "description": {{ item.description | default: item.excerpt | default: "" | strip_html | strip_newlines | jsonify }},
            "content": {{ item.content | strip_html | strip_newlines | truncate: content_limit | jsonify }},
            "collection": {{ item.collection | default: "pages" | jsonify }},
            "date": {{ item.date | date: "%Y-%m-%d" | jsonify }},
            "categories": {{ item.categories | default: empty | jsonify }},
            "tags": {{ item.tags | default: empty | jsonify }}
        }
        {%- assign first = false -%}
    {%- endif -%}
{%- endfor -%}
]
